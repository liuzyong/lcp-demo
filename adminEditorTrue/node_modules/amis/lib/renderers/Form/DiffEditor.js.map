{
    "version": 3,
    "file": "DiffEditor.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Form/DiffEditor.tsx"
    ],
    "names": [],
    "mappings": ";;;AAAA,wDAA0B;AAC1B,yCAAuC;AACvC,+BAAkD;AAClD,uCAAuC;AAEvC,yFAA2D;AAC3D,qEAAsC;AACtC,uDAAuD;AAEvD,SAAS,aAAa;IACpB,OAAO,IAAI,OAAO,CAAC,UAAA,OAAO;QACxB,OAAC,OAAe,CAAC,CAAC,yBAAyB,CAAC,EAAE,UAAC,SAAc;YAC3D,OAAA,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC;QAA1B,CAA0B,CAC3B;IAFD,CAEC,CACF,CAAC;AACJ,CAAC;AAQD,SAAS,cAAc,CAAC,KAAU,EAAE,QAAiB;IACnD,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;QACtC,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;KACxC;IAED,IAAI,QAAQ,IAAI,QAAQ,KAAK,MAAM,EAAE;QACnC,IAAI;YACF,KAAK,GAAG,IAAI,CAAC,SAAS,CACpB,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,EACrD,IAAI,EACJ,CAAC,CACF,CAAC;SACH;QAAC,OAAO,CAAC,EAAE,GAAE;KACf;IAED,OAAO,KAAK,CAAC;AACf,CAAC;AAED;IAAgC,sCAAqC;IA0BnE,oBAAY,KAAsB;QAAlC,YACE,kBAAM,KAAK,CAAC,SAkBb;QA7BD,WAAK,GAAG;YACN,OAAO,EAAE,KAAK;SACf,CAAC;QAMF,eAAS,GAAoB,EAAE,CAAC;QAK9B,KAAI,CAAC,WAAW,GAAG,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QAC/C,KAAI,CAAC,UAAU,GAAG,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QAC7C,KAAI,CAAC,aAAa,GAAG,KAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QACnD,KAAI,CAAC,mBAAmB,GAAG,KAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QAC/D,KAAI,CAAC,0BAA0B,GAAG,KAAI,CAAC,0BAA0B,CAAC,IAAI,CACpE,KAAI,CACL,CAAC;QACF,KAAI,CAAC,mBAAmB,GAAG,kBAAO,CAChC,KAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,KAAI,CAAC,EACnC,GAAG,EACH;YACE,QAAQ,EAAE,IAAI;YACd,OAAO,EAAE,KAAK;SACf,CACF,CAAC;QACF,KAAI,CAAC,SAAS,CAAC,IAAI,CAAE,KAAI,CAAC,mBAA2B,CAAC,MAAM,CAAC,CAAC;;IAChE,CAAC;IAED,yCAAoB,GAApB;QACE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,EAAE,IAAI,OAAA,EAAE,EAAE,EAAJ,CAAI,CAAC,CAAC;IACrC,CAAC;IAED,gCAAW,GAAX;QACE,IAAI,CAAC,QAAQ,CAAC;YACZ,OAAO,EAAE,IAAI;SACd,CAAC,CAAC;IACL,CAAC;IAED,+BAAU,GAAV;QACE,IAAI,CAAC,QAAQ,CAAC;YACZ,OAAO,EAAE,KAAK;SACf,CAAC,CAAC;IACL,CAAC;IAED,uCAAkB,GAAlB,UAAmB,SAAc;QACzB,IAAA,eAA+C,EAA9C,cAAI,EAAE,gBAAK,EAAE,wBAAS,EAAE,sBAAsB,CAAC;QAEtD,IACE,IAAI,CAAC,cAAc;YACnB,SAAS;YACT,CAAC,SAAS,KAAK,SAAS,CAAC,SAAS,IAAI,IAAI,KAAK,SAAS,CAAC,IAAI,CAAC,EAC9D;YACA,IAAI,CAAC,cAAc;iBAChB,QAAQ,EAAE;iBACV,QAAQ,CACP,4BAAc,CAAC,SAAmB,CAAC;gBACjC,CAAC,CAAC,cAAc,CAAC,YAAM,CAAC,SAAS,IAAI,EAAE,EAAE,IAAI,EAAE,OAAO,CAAC,EAAE,QAAQ,CAAC;gBAClE,CAAC,CAAC,cAAc,CAAC,SAAS,EAAE,QAAQ,CAAC,CACxC,CAAC;SACL;QAED,IACE,IAAI,CAAC,cAAc;YACnB,KAAK;YACL,KAAK,KAAK,SAAS,CAAC,KAAK;YACzB,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EACnB;YACA,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,QAAQ,CAAC,cAAc,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC;SAC1E;IACH,CAAC;IAED,kCAAa,GAAb,UAAc,gBAAqB,EAAE,MAAW,EAAE,OAAY;QAC5D,OAAO,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,OAAO,CAAC,CAAC;IACnE,CAAC;IAED,wCAAmB,GAAnB,UAAoB,MAAW,EAAE,MAAW;QACpC,IAAA,eAA+C,EAA9C,gBAAK,EAAE,cAAI,EAAE,sBAAQ,EAAE,wBAAuB,CAAC;QAEtD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,cAAc,GAAG,MAAM,CAAC,iBAAiB,EAAE,CAAC;QACjD,IAAI,CAAC,cAAc,GAAG,MAAM,CAAC,iBAAiB,EAAE,CAAC;QAEjD,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,OAAO,CACrE,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,IAAI,CAAC,cAAc,CAAC,qBAAqB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,OAAO,CACnE,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,IAAI,CAAC,cAAc,CAAC,uBAAuB,CACzC,IAAI,CAAC,0BAA0B,CAChC,CAAC,OAAO,CACV,CAAC;QAEF,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;YACnB,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,WAAW,CACtC,4BAAc,CAAC,SAAmB,CAAC;gBACjC,CAAC,CAAC,cAAc,CAAC,YAAM,CAAC,SAAS,IAAI,EAAE,EAAE,IAAI,EAAE,OAAO,CAAC,EAAE,QAAQ,CAAC;gBAClE,CAAC,CAAC,cAAc,CAAC,SAAS,EAAE,QAAQ,CAAC,EACvC,QAAQ,CACT;YACD,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,WAAW,CACtC,cAAc,CAAC,KAAK,EAAE,QAAQ,CAAC,EAC/B,QAAQ,CACT;SACF,CAAC,CAAC;QAEH,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAED,+CAA0B,GAA1B;QACS,IAAA,8BAAQ,CAAe;QAC9B,QAAQ,IAAI,QAAQ,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC;QAChE,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAED,wCAAmB,GAAnB;QACE,IAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC;QACnC,IAAM,SAAS,GAAG,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,UAAU,CAAC,UAAU,CAAC;QACtE,IAAM,aAAa,GAAG,MAAM,CAAC,gBAAgB,EAAE,CAAC;QAChD,IAAM,UAAU,GAAG,aAAa,CAAC,UAAU,CAAC;QAC5C,IAAM,SAAS,GAAG,MAAM,CAAC,QAAQ,EAAE,CAAC,YAAY,EAAE,CAAC;QACnD,IAAM,aAAa,GAAG,UAAU,GAAG,SAAS,CAAC;QAC7C,IAAM,yBAAyB,GAC7B,aAAa,CAAC,UAAU,CAAC,yBAAyB,CAAC;QACrD,IAAM,YAAY,GAAG,aAAa,GAAG,yBAAyB,CAAC;QAC/D,SAAS,CAAC,KAAK,CAAC,OAAO,GAAG,YAAU,YAAY,OAAI,CAAC;IACvD,CAAC;IAED,2BAAM,GAAN;QACQ,IAAA,eAUQ,EATZ,wBAAS,EACT,gBAAK,EACL,sBAAQ,EACR,sBAAQ,EACR,cAAI,EACJ,oBAAO,EACP,sBAAQ,EACR,gBAAK,EACL,kBACY,CAAC;QAEf,OAAO,CACL,uCACE,SAAS,EAAE,EAAE,CACX,eAAe,EACf,IAAI,CAAC,CAAC,CAAC,oBAAkB,IAAM,CAAC,CAAC,CAAC,EAAE,EACpC,SAAS,EACT;gBACE,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO;aACjC,CACF;YAED,8BAAC,uBAAa,IACZ,YAAY,EAAE,aAAa,EAC3B,KAAK,EAAE,KAAK,EACZ,QAAQ,EAAE,QAAQ,EAClB,QAAQ,EAAE,QAAQ,EAClB,QAAQ,EAAE,QAAQ,EAClB,KAAK,EAAE,KAAK,EACZ,cAAc,EAAE,IAAI,CAAC,mBAAmB,EACxC,aAAa,EAAE,IAAI,CAAC,aAAa,EACjC,OAAO,wCACF,OAAO,KACV,QAAQ,EAAE,QAAQ,MAEpB,CACE,CACP,CAAC;IACJ,CAAC;IA5LM,uBAAY,GAA6B;QAC9C,QAAQ,EAAE,YAAY;QACtB,KAAK,EAAE,IAAI;QACX,OAAO,EAAE;YACP,eAAe,EAAE,KAAK;YACtB,mBAAmB,EAAE,IAAI;YACzB,oBAAoB,EAAE,KAAK;YAC3B,OAAO,EAAE,IAAI;YACb,OAAO,EAAE;gBACP,OAAO,EAAE,KAAK;aACf;SACF;QACD,SAAS,EAAE,EAAE;KACd,CAAC;IAgLJ,iBAAC;CAAA,AA9LD,CAAgC,eAAK,CAAC,SAAS,GA8L9C;AA9LY,gCAAU;AAoMvB;IAA+C,qDAAU;IAAzD;;IAIA,CAAC;IAHQ,sCAAY,wBACd,UAAU,CAAC,YAAY,EAC1B;IAHS,yBAAyB;QAJrC,eAAQ,CAAC;YACR,IAAI,EAAE,aAAa;YACnB,WAAW,EAAE,KAAK;SACnB,CAAC;OACW,yBAAyB,CAIrC;IAAD,gCAAC;CAAA,AAJD,CAA+C,UAAU,GAIxD;AAJY,8DAAyB;AAUtC;IAAwC,8CAAU;IAAlD;;IAKA,CAAC;IAJQ,+BAAY,yCACd,UAAU,CAAC,YAAY,KAC1B,QAAQ,EAAE,IAAI,IACd;IAJS,kBAAkB;QAJ9B,kBAAQ,CAAC;YACR,IAAI,EAAE,oBAAoB;YAC1B,IAAI,EAAE,aAAa;SACpB,CAAC;OACW,kBAAkB,CAK9B;IAAD,yBAAC;CAAA,AALD,CAAwC,UAAU,GAKjD;AALY,gDAAkB",
    "sourcesContent": [
        "import React from 'react';\nimport {Renderer} from '../../factory';\nimport {FormItem, FormControlProps} from './Item';\nimport {filter} from '../../utils/tpl';\nimport cx from 'classnames';\nimport LazyComponent from '../../components/LazyComponent';\nimport debouce from 'lodash/debounce';\nimport {isPureVariable} from '../../utils/tpl-builtin';\n\nfunction loadComponent(): Promise<React.ReactType> {\n  return new Promise(resolve =>\n    (require as any)(['../../components/Editor'], (component: any) =>\n      resolve(component.default)\n    )\n  );\n}\n\nexport interface DiffEditorProps extends FormControlProps {\n  options?: object;\n  language?: string;\n  diffValue?: string;\n}\n\nfunction normalizeValue(value: any, language?: string) {\n  if (value && typeof value !== 'string') {\n    value = JSON.stringify(value, null, 4);\n  }\n\n  if (language && language === 'json') {\n    try {\n      value = JSON.stringify(\n        typeof value === 'string' ? JSON.parse(value) : value,\n        null,\n        4\n      );\n    } catch (e) {}\n  }\n\n  return value;\n}\n\nexport class DiffEditor extends React.Component<DiffEditorProps, any> {\n  static defaultProps: Partial<DiffEditorProps> = {\n    language: 'javascript',\n    theme: 'vs',\n    options: {\n      automaticLayout: false,\n      selectOnLineNumbers: true,\n      scrollBeyondLastLine: false,\n      folding: true,\n      minimap: {\n        enabled: false\n      }\n    },\n    diffValue: ''\n  };\n\n  state = {\n    focused: false\n  };\n\n  editor: any;\n  monaco: any;\n  originalEditor: any;\n  modifiedEditor: any;\n  toDispose: Array<Function> = [];\n\n  constructor(props: DiffEditorProps) {\n    super(props);\n\n    this.handleFocus = this.handleFocus.bind(this);\n    this.handleBlur = this.handleBlur.bind(this);\n    this.editorFactory = this.editorFactory.bind(this);\n    this.handleEditorMounted = this.handleEditorMounted.bind(this);\n    this.handleModifiedEditorChange = this.handleModifiedEditorChange.bind(\n      this\n    );\n    this.updateContainerSize = debouce(\n      this.updateContainerSize.bind(this),\n      250,\n      {\n        trailing: true,\n        leading: false\n      }\n    );\n    this.toDispose.push((this.updateContainerSize as any).cancel);\n  }\n\n  componentWillUnmount() {\n    this.toDispose.forEach(fn => fn());\n  }\n\n  handleFocus() {\n    this.setState({\n      focused: true\n    });\n  }\n\n  handleBlur() {\n    this.setState({\n      focused: false\n    });\n  }\n\n  componentDidUpdate(prevProps: any) {\n    const {data, value, diffValue, language} = this.props;\n\n    if (\n      this.originalEditor &&\n      diffValue &&\n      (diffValue !== prevProps.diffValue || data !== prevProps.data)\n    ) {\n      this.originalEditor\n        .getModel()\n        .setValue(\n          isPureVariable(diffValue as string)\n            ? normalizeValue(filter(diffValue || '', data, '| raw'), language)\n            : normalizeValue(diffValue, language)\n        );\n    }\n\n    if (\n      this.modifiedEditor &&\n      value &&\n      value !== prevProps.value &&\n      !this.state.focused\n    ) {\n      this.modifiedEditor.getModel().setValue(normalizeValue(value, language));\n    }\n  }\n\n  editorFactory(containerElement: any, monaco: any, options: any) {\n    return monaco.editor.createDiffEditor(containerElement, options);\n  }\n\n  handleEditorMounted(editor: any, monaco: any) {\n    const {value, data, language, diffValue} = this.props;\n\n    this.monaco = monaco;\n    this.editor = editor;\n    this.modifiedEditor = editor.getModifiedEditor();\n    this.originalEditor = editor.getOriginalEditor();\n\n    this.toDispose.push(\n      this.modifiedEditor.onDidFocusEditorWidget(this.handleFocus).dispose\n    );\n    this.toDispose.push(\n      this.modifiedEditor.onDidBlurEditorWidget(this.handleBlur).dispose\n    );\n    this.toDispose.push(\n      this.modifiedEditor.onDidChangeModelContent(\n        this.handleModifiedEditorChange\n      ).dispose\n    );\n\n    this.editor.setModel({\n      original: this.monaco.editor.createModel(\n        isPureVariable(diffValue as string)\n          ? normalizeValue(filter(diffValue || '', data, '| raw'), language)\n          : normalizeValue(diffValue, language),\n        language\n      ),\n      modified: this.monaco.editor.createModel(\n        normalizeValue(value, language),\n        language\n      )\n    });\n\n    this.updateContainerSize();\n  }\n\n  handleModifiedEditorChange() {\n    const {onChange} = this.props;\n    onChange && onChange(this.modifiedEditor.getModel().getValue());\n    this.updateContainerSize();\n  }\n\n  updateContainerSize() {\n    const editor = this.modifiedEditor;\n    const parentDom = editor._domElement.parentNode.parentNode.parentNode;\n    const configuration = editor.getConfiguration();\n    const lineHeight = configuration.lineHeight;\n    const lineCount = editor.getModel().getLineCount();\n    const contentHeight = lineHeight * lineCount;\n    const horizontalScrollbarHeight =\n      configuration.layoutInfo.horizontalScrollbarHeight;\n    const editorHeight = contentHeight + horizontalScrollbarHeight;\n    parentDom.style.cssText = `height:${editorHeight}px`;\n  }\n\n  render() {\n    const {\n      className,\n      value,\n      onChange,\n      disabled,\n      size,\n      options,\n      language,\n      theme,\n      classnames: cx\n    } = this.props;\n\n    return (\n      <div\n        className={cx(\n          'EditorControl',\n          size ? `EditorControl--${size}` : '',\n          className,\n          {\n            'is-focused': this.state.focused\n          }\n        )}\n      >\n        <LazyComponent\n          getComponent={loadComponent}\n          value={value}\n          onChange={onChange}\n          disabled={disabled}\n          language={language}\n          theme={theme}\n          editorDidMount={this.handleEditorMounted}\n          editorFactory={this.editorFactory}\n          options={{\n            ...options,\n            readOnly: disabled\n          }}\n        />\n      </div>\n    );\n  }\n}\n\n@FormItem({\n  type: `diff-editor`,\n  sizeMutable: false\n})\nexport class DiffEditorControlRenderer extends DiffEditor {\n  static defaultProps = {\n    ...DiffEditor.defaultProps\n  };\n}\n\n@Renderer({\n  test: /(^|\\/)diff-editor$/,\n  name: 'diff-editor'\n})\nexport class DiffEditorRenderer extends DiffEditor {\n  static defaultProps = {\n    ...DiffEditor.defaultProps,\n    disabled: true\n  };\n}\n"
    ]
}